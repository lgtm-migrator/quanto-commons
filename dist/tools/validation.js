'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; /* eslint-disable no-plusplus */
/**
 * Created by Lucas Teske on 20/04/17.
 * 
 */

exports.isRunningInNodeJS = isRunningInNodeJS;
exports.normalizeXMLJSObjectProperties = normalizeXMLJSObjectProperties;
exports.validateEmail = validateEmail;
exports.validateCPF = validateCPF;
exports.validateCNPJ = validateCNPJ;
exports.undefinedOrNull = undefinedOrNull;
exports.validateField = validateField;
exports.validateDateFormat = validateDateFormat;
exports.validateStringLength = validateStringLength;
exports.calcDvMod11 = calcDvMod11;
exports.calcDvMod11Sub11 = calcDvMod11Sub11;
exports.calcDvAgencia = calcDvAgencia;
exports.calcDvConta = calcDvConta;
exports.calcDvMod10 = calcDvMod10;
exports.cleanUndefinedMembers = cleanUndefinedMembers;

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function isRunningInNodeJS() {
  return typeof module !== 'undefined' && module.exports;
}

function normalizeXMLJSObjectProperties(obj) {
  var keys = Object.keys(obj);
  var nObj = {};
  for (var i = 0; i < keys.length; i += 1) {
    var k = keys[i];
    if (_typeof(obj[k]) === 'object') {
      normalizeXMLJSObjectProperties(obj[k]);
    }
    var t = JSON.parse(JSON.stringify(obj[k][0]));
    if (t !== 'undefined') {
      nObj[k.toLowerCase()] = t !== 'NULL' ? t : null;
    }
  }

  return nObj;
}

function validateEmail(email) {
  var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(email);
}

function validateCPF(cpfO) {
  var sum = 0;
  var hash = void 0;

  if (cpfO === undefined || cpfO === null) {
    return false;
  }

  var cpf = cpfO.replace(/[^\d]+/g, '');

  if (cpf.length !== '00000000000'.length) {
    return false;
  }

  if (cpf === '00000000000') {
    return false;
  }

  for (var i = 1; i <= 9; i++) {
    sum += parseInt(cpf.substring(i - 1, i), 10) * (11 - i);
  }

  hash = sum * 10 % 11;

  if (hash === 10 || hash === 11) {
    hash = 0;
  }

  if (hash !== parseInt(cpf.substring(9, 10), 10)) {
    return false;
  }

  // Verification digit
  sum = 0;
  for (var _i = 1; _i <= 10; _i++) {
    sum += parseInt(cpf.substring(_i - 1, _i), 10) * (12 - _i);
  }

  hash = sum * 10 % 11;

  if (hash === 10 || hash === 11) {
    hash = 0;
  }

  return hash === parseInt(cpf.substring(10, 11), 10);
}

function validateCNPJ(cnpjO) {
  if (cnpjO === undefined || cnpjO === null || cnpjO.length !== 14) {
    return false;
  }

  var cnpj = cnpjO.replace(/[^\d]+/g, '');

  if (cnpj.length === 0 || cnpj.length !== 14 || cnpj === '00000000000000' || cnpj === '11111111111111' || cnpj === '22222222222222' || cnpj === '33333333333333' || cnpj === '44444444444444' || cnpj === '55555555555555' || cnpj === '66666666666666' || cnpj === '77777777777777' || cnpj === '88888888888888' || cnpj === '99999999999999') {
    return false;
  }

  var size = cnpj.length - 2;
  var numbers = cnpj.substring(0, size);
  var digits = cnpj.substring(size);
  var sum = 0;
  var pos = size - 7;
  for (var i = size; i >= 1; i--) {
    sum += parseInt(numbers.charAt(size - i), 10) * pos--;
    if (pos < 2) {
      pos = 9;
    }
  }

  var resultado = sum % 11 < 2 ? 0 : 11 - sum % 11;
  if (resultado !== parseInt(digits.charAt(0), 10)) {
    return false;
  }

  size += 1;
  numbers = cnpj.substring(0, size);
  sum = 0;
  pos = size - 7;

  for (var _i2 = size; _i2 >= 1; _i2--) {
    sum += parseInt(numbers.charAt(size - _i2), 10) * pos--;
    if (pos < 2) {
      pos = 9;
    }
  }
  resultado = sum % 11 < 2 ? 0 : 11 - sum % 11;
  return resultado === parseInt(digits.charAt(1), 10);
}

function undefinedOrNull(field) {
  return field === undefined || field === null;
}

function validateField(fieldValue, validationFn) {
  return validationFn(fieldValue);
}

function validateDateFormat(field, format) {
  return (0, _moment2.default)(field, format, true).isValid();
}

function validateStringLength(field, max, min) {
  return field.length < max && (min !== undefined && field.length > min || min === undefined);
}

function calcDvMod11(data) {
  var sum = 0;
  for (var i = 0; i < data.length; i++) {
    sum += parseInt(data[i], 10) * (data.length - i + 1);
  }
  return sum % 11;
}

function calcDvMod11Sub11(data) {
  var c = calcDvMod11(data);
  return c > 0 ? 11 - c : 0;
}

function calcDvAgencia(branchNumber) {
  return calcDvMod11Sub11(branchNumber.padLeft(4, '0'));
}

function calcDvConta(accountNumber) {
  return calcDvMod11(accountNumber.toString()) % 10;
}

function calcDvMod10(data) {
  var sum = 0;
  for (var i = 0; i < data.length; i++) {
    var partial = parseInt(data[i], 10) * (i % 2 + 1);
    if (partial > 9) {
      partial = partial.toString().split('').map(function (c) {
        return parseInt(c, 10);
      }).reduce(function (a, b) {
        return a + b;
      });
    }
    sum += partial;
  }
  sum %= 10;
  sum = sum !== 0 ? 10 - sum : sum;

  return sum;
}

function cleanUndefinedMembers(obj) {
  Object.keys(obj).forEach(function (key) {
    if (obj[key] && _typeof(obj[key]) === 'object') {
      cleanUndefinedMembers(obj[key]);
    } else if (obj[key] === undefined) {
      delete obj[key];
    }
  });

  return obj;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90b29scy92YWxpZGF0aW9uLmpzIl0sIm5hbWVzIjpbImlzUnVubmluZ0luTm9kZUpTIiwibm9ybWFsaXplWE1MSlNPYmplY3RQcm9wZXJ0aWVzIiwidmFsaWRhdGVFbWFpbCIsInZhbGlkYXRlQ1BGIiwidmFsaWRhdGVDTlBKIiwidW5kZWZpbmVkT3JOdWxsIiwidmFsaWRhdGVGaWVsZCIsInZhbGlkYXRlRGF0ZUZvcm1hdCIsInZhbGlkYXRlU3RyaW5nTGVuZ3RoIiwiY2FsY0R2TW9kMTEiLCJjYWxjRHZNb2QxMVN1YjExIiwiY2FsY0R2QWdlbmNpYSIsImNhbGNEdkNvbnRhIiwiY2FsY0R2TW9kMTAiLCJjbGVhblVuZGVmaW5lZE1lbWJlcnMiLCJtb2R1bGUiLCJleHBvcnRzIiwib2JqIiwia2V5cyIsIk9iamVjdCIsIm5PYmoiLCJpIiwibGVuZ3RoIiwiayIsInQiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ0b0xvd2VyQ2FzZSIsImVtYWlsIiwicmUiLCJ0ZXN0IiwiY3BmTyIsInN1bSIsImhhc2giLCJ1bmRlZmluZWQiLCJjcGYiLCJyZXBsYWNlIiwicGFyc2VJbnQiLCJzdWJzdHJpbmciLCJjbnBqTyIsImNucGoiLCJzaXplIiwibnVtYmVycyIsImRpZ2l0cyIsInBvcyIsImNoYXJBdCIsInJlc3VsdGFkbyIsImZpZWxkIiwiZmllbGRWYWx1ZSIsInZhbGlkYXRpb25GbiIsImZvcm1hdCIsImlzVmFsaWQiLCJtYXgiLCJtaW4iLCJkYXRhIiwiYyIsImJyYW5jaE51bWJlciIsInBhZExlZnQiLCJhY2NvdW50TnVtYmVyIiwidG9TdHJpbmciLCJwYXJ0aWFsIiwic3BsaXQiLCJtYXAiLCJyZWR1Y2UiLCJhIiwiYiIsImZvckVhY2giLCJrZXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs4UUFBQTtBQUNBOzs7OztRQU9nQkEsaUIsR0FBQUEsaUI7UUFFQUMsOEIsR0FBQUEsOEI7UUFpQkFDLGEsR0FBQUEsYTtRQUtBQyxXLEdBQUFB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OiJ2YWxpZGF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tcGx1c3BsdXMgKi9cbi8qKlxuICogQ3JlYXRlZCBieSBMdWNhcyBUZXNrZSBvbiAyMC8wNC8xNy5cbiAqIEBmbG93XG4gKi9cblxuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNSdW5uaW5nSW5Ob2RlSlMoKSB7IHJldHVybiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0czsgfVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplWE1MSlNPYmplY3RQcm9wZXJ0aWVzKG9iajogT2JqZWN0KSA6IE9iamVjdCB7XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuICBjb25zdCBuT2JqID0ge307XG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGNvbnN0IGsgPSBrZXlzW2ldO1xuICAgIGlmICh0eXBlb2Ygb2JqW2tdID09PSAnb2JqZWN0Jykge1xuICAgICAgbm9ybWFsaXplWE1MSlNPYmplY3RQcm9wZXJ0aWVzKG9ialtrXSk7XG4gICAgfVxuICAgIGNvbnN0IHQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9ialtrXVswXSkpO1xuICAgIGlmICh0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgbk9ialtrLnRvTG93ZXJDYXNlKCldID0gdCAhPT0gJ05VTEwnID8gdCA6IG51bGw7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5PYmo7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUVtYWlsKGVtYWlsOiBzdHJpbmcpIHtcbiAgY29uc3QgcmUgPSAvXigoW148PigpXFxbXFxdXFxcXC4sOzpcXHNAXCJdKyhcXC5bXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKSopfChcIi4rXCIpKUAoKFxcW1swLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31dKXwoKFthLXpBLVpcXC0wLTldK1xcLikrW2EtekEtWl17Mix9KSkkLztcbiAgcmV0dXJuIHJlLnRlc3QoZW1haWwpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVDUEYoY3BmTzogc3RyaW5nKSA6IGJvb2xlYW4ge1xuICBsZXQgc3VtID0gMDtcbiAgbGV0IGhhc2g7XG5cbiAgaWYgKGNwZk8gPT09IHVuZGVmaW5lZCB8fCBjcGZPID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgY3BmID0gY3BmTy5yZXBsYWNlKC9bXlxcZF0rL2csICcnKTtcblxuICBpZiAoY3BmLmxlbmd0aCAhPT0gJzAwMDAwMDAwMDAwJy5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoY3BmID09PSAnMDAwMDAwMDAwMDAnKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gOTsgaSsrKSB7XG4gICAgc3VtICs9IHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoaSAtIDEsIGkpLCAxMCkgKiAoMTEgLSBpKTtcbiAgfVxuXG4gIGhhc2ggPSAoc3VtICogMTApICUgMTE7XG5cbiAgaWYgKChoYXNoID09PSAxMCkgfHwgKGhhc2ggPT09IDExKSkge1xuICAgIGhhc2ggPSAwO1xuICB9XG5cbiAgaWYgKGhhc2ggIT09IHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoOSwgMTApLCAxMCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBWZXJpZmljYXRpb24gZGlnaXRcbiAgc3VtID0gMDtcbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gMTA7IGkrKykge1xuICAgIHN1bSArPSBwYXJzZUludChjcGYuc3Vic3RyaW5nKGkgLSAxLCBpKSwgMTApICogKDEyIC0gaSk7XG4gIH1cblxuICBoYXNoID0gKHN1bSAqIDEwKSAlIDExO1xuXG4gIGlmICgoaGFzaCA9PT0gMTApIHx8IChoYXNoID09PSAxMSkpIHtcbiAgICBoYXNoID0gMDtcbiAgfVxuXG4gIHJldHVybiBoYXNoID09PSBwYXJzZUludChjcGYuc3Vic3RyaW5nKDEwLCAxMSksIDEwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ05QSihjbnBqTzogc3RyaW5nKSA6IGJvb2xlYW4ge1xuICBpZiAoY25wak8gPT09IHVuZGVmaW5lZCB8fCBjbnBqTyA9PT0gbnVsbCB8fCBjbnBqTy5sZW5ndGggIT09IDE0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgY25waiA9IGNucGpPLnJlcGxhY2UoL1teXFxkXSsvZywgJycpO1xuXG4gIGlmIChcbiAgICBjbnBqLmxlbmd0aCA9PT0gMCB8fFxuICAgIGNucGoubGVuZ3RoICE9PSAxNCB8fFxuICAgIGNucGogPT09ICcwMDAwMDAwMDAwMDAwMCcgfHxcbiAgICBjbnBqID09PSAnMTExMTExMTExMTExMTEnIHx8XG4gICAgY25waiA9PT0gJzIyMjIyMjIyMjIyMjIyJyB8fFxuICAgIGNucGogPT09ICczMzMzMzMzMzMzMzMzMycgfHxcbiAgICBjbnBqID09PSAnNDQ0NDQ0NDQ0NDQ0NDQnIHx8XG4gICAgY25waiA9PT0gJzU1NTU1NTU1NTU1NTU1JyB8fFxuICAgIGNucGogPT09ICc2NjY2NjY2NjY2NjY2NicgfHxcbiAgICBjbnBqID09PSAnNzc3Nzc3Nzc3Nzc3NzcnIHx8XG4gICAgY25waiA9PT0gJzg4ODg4ODg4ODg4ODg4JyB8fFxuICAgIGNucGogPT09ICc5OTk5OTk5OTk5OTk5OSdcbiAgKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbGV0IHNpemUgPSBjbnBqLmxlbmd0aCAtIDI7XG4gIGxldCBudW1iZXJzID0gY25wai5zdWJzdHJpbmcoMCwgc2l6ZSk7XG4gIGNvbnN0IGRpZ2l0cyA9IGNucGouc3Vic3RyaW5nKHNpemUpO1xuICBsZXQgc3VtID0gMDtcbiAgbGV0IHBvcyA9IHNpemUgLSA3O1xuICBmb3IgKGxldCBpID0gc2l6ZTsgaSA+PSAxOyBpLS0pIHtcbiAgICBzdW0gKz0gcGFyc2VJbnQobnVtYmVycy5jaGFyQXQoc2l6ZSAtIGkpLCAxMCkgKiBwb3MtLTtcbiAgICBpZiAocG9zIDwgMikge1xuICAgICAgcG9zID0gOTtcbiAgICB9XG4gIH1cblxuICBsZXQgcmVzdWx0YWRvID0gc3VtICUgMTEgPCAyID8gMCA6IDExIC0gKHN1bSAlIDExKTtcbiAgaWYgKHJlc3VsdGFkbyAhPT0gcGFyc2VJbnQoZGlnaXRzLmNoYXJBdCgwKSwgMTApKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgc2l6ZSArPSAxO1xuICBudW1iZXJzID0gY25wai5zdWJzdHJpbmcoMCwgc2l6ZSk7XG4gIHN1bSA9IDA7XG4gIHBvcyA9IHNpemUgLSA3O1xuXG4gIGZvciAobGV0IGkgPSBzaXplOyBpID49IDE7IGktLSkge1xuICAgIHN1bSArPSBwYXJzZUludChudW1iZXJzLmNoYXJBdChzaXplIC0gaSksIDEwKSAqIHBvcy0tO1xuICAgIGlmIChwb3MgPCAyKSB7XG4gICAgICBwb3MgPSA5O1xuICAgIH1cbiAgfVxuICByZXN1bHRhZG8gPSBzdW0gJSAxMSA8IDIgPyAwIDogMTEgLSAoc3VtICUgMTEpO1xuICByZXR1cm4gcmVzdWx0YWRvID09PSBwYXJzZUludChkaWdpdHMuY2hhckF0KDEpLCAxMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1bmRlZmluZWRPck51bGwoZmllbGQ6IGFueSkge1xuICByZXR1cm4gZmllbGQgPT09IHVuZGVmaW5lZCB8fCBmaWVsZCA9PT0gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlRmllbGQoZmllbGRWYWx1ZTogYW55LCB2YWxpZGF0aW9uRm46IGFueSkgOiBib29sZWFuIHtcbiAgcmV0dXJuIHZhbGlkYXRpb25GbihmaWVsZFZhbHVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlRGF0ZUZvcm1hdChmaWVsZDogc3RyaW5nLCBmb3JtYXQ6IHN0cmluZykge1xuICByZXR1cm4gbW9tZW50KGZpZWxkLCBmb3JtYXQsIHRydWUpLmlzVmFsaWQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlU3RyaW5nTGVuZ3RoKGZpZWxkOiBzdHJpbmcsIG1heDogbnVtYmVyLCBtaW46IG51bWJlciB8IHZvaWQpIHtcbiAgcmV0dXJuIChmaWVsZC5sZW5ndGggPCBtYXgpICYmICgobWluICE9PSB1bmRlZmluZWQgJiYgZmllbGQubGVuZ3RoID4gbWluKSB8fCBtaW4gPT09IHVuZGVmaW5lZCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjRHZNb2QxMShkYXRhOiBzdHJpbmcpIHtcbiAgbGV0IHN1bSA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgIHN1bSArPSAocGFyc2VJbnQoZGF0YVtpXSwgMTApICogKChkYXRhLmxlbmd0aCAtIGkpICsgMSkpO1xuICB9XG4gIHJldHVybiBzdW0gJSAxMTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGNEdk1vZDExU3ViMTEoZGF0YTogc3RyaW5nKSB7XG4gIGNvbnN0IGMgPSBjYWxjRHZNb2QxMShkYXRhKTtcbiAgcmV0dXJuIGMgPiAwID8gMTEgLSBjIDogMDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGNEdkFnZW5jaWEoYnJhbmNoTnVtYmVyOiBudW1iZXJ8c3RyaW5nKSB7XG4gIHJldHVybiBjYWxjRHZNb2QxMVN1YjExKGJyYW5jaE51bWJlci5wYWRMZWZ0KDQsICcwJykpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0R2Q29udGEoYWNjb3VudE51bWJlcjogbnVtYmVyfHN0cmluZykge1xuICByZXR1cm4gY2FsY0R2TW9kMTEoYWNjb3VudE51bWJlci50b1N0cmluZygpKSAlIDEwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0R2TW9kMTAoZGF0YTogc3RyaW5nKSB7XG4gIGxldCBzdW0gPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgcGFydGlhbCA9IChwYXJzZUludChkYXRhW2ldLCAxMCkgKiAoKGkgJSAyKSArIDEpKTtcbiAgICBpZiAocGFydGlhbCA+IDkpIHtcbiAgICAgIHBhcnRpYWwgPSBwYXJ0aWFsLnRvU3RyaW5nKCkuc3BsaXQoJycpLm1hcChjID0+IHBhcnNlSW50KGMsIDEwKSkucmVkdWNlKChhLCBiKSA9PiBhICsgYik7XG4gICAgfVxuICAgIHN1bSArPSBwYXJ0aWFsO1xuICB9XG4gIHN1bSAlPSAxMDtcbiAgc3VtID0gc3VtICE9PSAwID8gMTAgLSBzdW0gOiBzdW07XG5cbiAgcmV0dXJuIHN1bTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuVW5kZWZpbmVkTWVtYmVycyhvYmopIHtcbiAgT2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICBpZiAob2JqW2tleV0gJiYgdHlwZW9mIG9ialtrZXldID09PSAnb2JqZWN0Jykge1xuICAgICAgY2xlYW5VbmRlZmluZWRNZW1iZXJzKG9ialtrZXldKTtcbiAgICB9IGVsc2UgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGRlbGV0ZSBvYmpba2V5XTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBvYmo7XG59XG4iXX0=