'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; /**
                                                                                                                                                                                                                                                                               * Created by Lucas Teske on 20/04/17.
                                                                                                                                                                                                                                                                               * 
                                                                                                                                                                                                                                                                               */

exports.normalizeXMLJSObjectProperties = normalizeXMLJSObjectProperties;
exports.validateEmail = validateEmail;
exports.validateCPF = validateCPF;
exports.validateCNPJ = validateCNPJ;
exports.undefinedOrNull = undefinedOrNull;
exports.validateField = validateField;
exports.validateDateFormat = validateDateFormat;
exports.validateStringLength = validateStringLength;
exports.calcDvMod11 = calcDvMod11;
exports.calcDvMod11Sub11 = calcDvMod11Sub11;
exports.calcDvAgencia = calcDvAgencia;
exports.calcDvConta = calcDvConta;
exports.calcDvMod10 = calcDvMod10;

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function normalizeXMLJSObjectProperties(obj) {
  var keys = Object.keys(obj);
  var nObj = {};
  for (var i = 0; i < keys.length; i += 1) {
    var k = keys[i];
    if (_typeof(obj[k]) === 'object') {
      normalizeXMLJSObjectProperties(obj[k]);
    }
    var t = JSON.parse(JSON.stringify(obj[k][0]));
    if (t !== 'undefined') {
      nObj[k.toLowerCase()] = t !== 'NULL' ? t : null;
    }
  }

  return nObj;
}

function validateEmail(email) {
  var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(email);
}

function validateCPF(cpfO) {
  var sum = 0;
  var hash = void 0;

  if (cpfO === undefined || cpfO === null) {
    return false;
  }

  var cpf = cpfO.replace(/[^\d]+/g, '');

  if (cpf.length !== '00000000000'.length) {
    return false;
  }

  if (cpf === '00000000000') {
    return false;
  }

  for (var i = 1; i <= 9; i++) {
    sum += parseInt(cpf.substring(i - 1, i), 10) * (11 - i);
  }

  hash = sum * 10 % 11;

  if (hash === 10 || hash === 11) {
    hash = 0;
  }

  if (hash !== parseInt(cpf.substring(9, 10), 10)) {
    return false;
  }

  // Verification digit
  sum = 0;
  for (var _i = 1; _i <= 10; _i++) {
    sum += parseInt(cpf.substring(_i - 1, _i), 10) * (12 - _i);
  }

  hash = sum * 10 % 11;

  if (hash === 10 || hash === 11) {
    hash = 0;
  }

  return hash === parseInt(cpf.substring(10, 11), 10);
}

function validateCNPJ(cnpjO) {
  if (cnpjO === undefined || cnpjO === null || cnpjO.length !== 14) {
    return false;
  }

  var cnpj = cnpjO.replace(/[^\d]+/g, '');

  if (cnpj.length === 0 || cnpj.length !== 14 || cnpj === '00000000000000' || cnpj === '11111111111111' || cnpj === '22222222222222' || cnpj === '33333333333333' || cnpj === '44444444444444' || cnpj === '55555555555555' || cnpj === '66666666666666' || cnpj === '77777777777777' || cnpj === '88888888888888' || cnpj === '99999999999999') {
    return false;
  }

  var size = cnpj.length - 2;
  var numbers = cnpj.substring(0, size);
  var digits = cnpj.substring(size);
  var sum = 0;
  var pos = size - 7;
  for (var i = size; i >= 1; i--) {
    sum += parseInt(numbers.charAt(size - i), 10) * pos--;
    if (pos < 2) {
      pos = 9;
    }
  }

  var resultado = sum % 11 < 2 ? 0 : 11 - sum % 11;
  if (resultado !== parseInt(digits.charAt(0), 10)) {
    return false;
  }

  size += 1;
  numbers = cnpj.substring(0, size);
  sum = 0;
  pos = size - 7;

  for (var _i2 = size; _i2 >= 1; _i2--) {
    sum += parseInt(numbers.charAt(size - _i2), 10) * pos--;
    if (pos < 2) {
      pos = 9;
    }
  }
  resultado = sum % 11 < 2 ? 0 : 11 - sum % 11;
  return resultado === parseInt(digits.charAt(1), 10);
}

function undefinedOrNull(field) {
  return field === undefined || field === null;
}

function validateField(fieldValue, validationFn) {
  return validationFn(fieldValue);
}

function validateDateFormat(field, format) {
  return (0, _moment2.default)(field, format, true).isValid();
}

function validateStringLength(field, max, min) {
  return field.length < max && (min !== undefined && field.length > min || min === undefined);
}

function calcDvMod11(data) {
  var sum = 0;
  for (var i = 0; i < data.length; i++) {
    sum += parseInt(data[i], 10) * (data.length - i + 1);
  }
  return sum % 11;
}

function calcDvMod11Sub11(data) {
  var c = calcDvMod11(data);
  return c > 0 ? 11 - c : 0;
}

function calcDvAgencia(branchNumber) {
  return calcDvMod11Sub11(branchNumber.padLeft(4, '0'));
}

function calcDvConta(accountNumber) {
  return calcDvMod11(accountNumber.toString());
}

function calcDvMod10(data) {
  var sum = 0;
  for (var i = 0; i < data.length; i++) {
    var partial = parseInt(data[i], 10) * (i % 2 + 1);
    if (partial > 9) {
      partial = partial.toString().split('').map(function (c) {
        return parseInt(c, 10);
      }).reduce(function (a, b) {
        return a + b;
      });
    }
    sum += partial;
  }
  sum %= 10;
  sum = sum !== 0 ? 10 - sum : sum;

  return sum;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90b29scy92YWxpZGF0aW9uLmpzIl0sIm5hbWVzIjpbIm5vcm1hbGl6ZVhNTEpTT2JqZWN0UHJvcGVydGllcyIsInZhbGlkYXRlRW1haWwiLCJ2YWxpZGF0ZUNQRiIsInZhbGlkYXRlQ05QSiIsInVuZGVmaW5lZE9yTnVsbCIsInZhbGlkYXRlRmllbGQiLCJ2YWxpZGF0ZURhdGVGb3JtYXQiLCJ2YWxpZGF0ZVN0cmluZ0xlbmd0aCIsImNhbGNEdk1vZDExIiwiY2FsY0R2TW9kMTFTdWIxMSIsImNhbGNEdkFnZW5jaWEiLCJjYWxjRHZDb250YSIsImNhbGNEdk1vZDEwIiwib2JqIiwia2V5cyIsIk9iamVjdCIsIm5PYmoiLCJpIiwibGVuZ3RoIiwiayIsInQiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ0b0xvd2VyQ2FzZSIsImVtYWlsIiwicmUiLCJ0ZXN0IiwiY3BmTyIsInN1bSIsImhhc2giLCJ1bmRlZmluZWQiLCJjcGYiLCJyZXBsYWNlIiwicGFyc2VJbnQiLCJzdWJzdHJpbmciLCJjbnBqTyIsImNucGoiLCJzaXplIiwibnVtYmVycyIsImRpZ2l0cyIsInBvcyIsImNoYXJBdCIsInJlc3VsdGFkbyIsImZpZWxkIiwiZmllbGRWYWx1ZSIsInZhbGlkYXRpb25GbiIsImZvcm1hdCIsImlzVmFsaWQiLCJtYXgiLCJtaW4iLCJkYXRhIiwiYyIsImJyYW5jaE51bWJlciIsInBhZExlZnQiLCJhY2NvdW50TnVtYmVyIiwidG9TdHJpbmciLCJwYXJ0aWFsIiwic3BsaXQiLCJtYXAiLCJyZWR1Y2UiLCJhIiwiYiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OzhRQUFBOzs7OztRQU9nQkEsOEIsR0FBQUEsOEI7UUFpQkFDLGEsR0FBQUEsYTtRQUtBQyxXLEdBQUFBLFc7UUErQ0FDLFksR0FBQUEsWTtRQXdEQUMsZSxHQUFBQSxlO1FBSUFDLGEsR0FBQUEsYTtRQUlBQyxrQixHQUFBQSxrQjtRQUlBQyxvQixHQUFBQSxvQjtRQUlBQyxXLEdBQUFBLFc7UUFRQUMsZ0IsR0FBQUEsZ0I7UUFLQUMsYSxHQUFBQSxhO1FBSUFDLFcsR0FBQUEsVztRQUlBQyxXLEdBQUFBLFc7O0FBcEtoQjs7Ozs7O0FBRU8sU0FBU1osOEJBQVQsQ0FBd0NhLEdBQXhDLEVBQThEO0FBQ25FLE1BQU1DLE9BQU9DLE9BQU9ELElBQVAsQ0FBWUQsR0FBWixDQUFiO0FBQ0EsTUFBTUcsT0FBTyxFQUFiO0FBQ0EsT0FBSyxJQUFJQyxJQUFJLENBQWIsRUFBZ0JBLElBQUlILEtBQUtJLE1BQXpCLEVBQWlDRCxLQUFLLENBQXRDLEVBQXlDO0FBQ3ZDLFFBQU1FLElBQUlMLEtBQUtHLENBQUwsQ0FBVjtBQUNBLFFBQUksUUFBT0osSUFBSU0sQ0FBSixDQUFQLE1BQWtCLFFBQXRCLEVBQWdDO0FBQzlCbkIscUNBQStCYSxJQUFJTSxDQUFKLENBQS9CO0FBQ0Q7QUFDRCxRQUFNQyxJQUFJQyxLQUFLQyxLQUFMLENBQVdELEtBQUtFLFNBQUwsQ0FBZVYsSUFBSU0sQ0FBSixFQUFPLENBQVAsQ0FBZixDQUFYLENBQVY7QUFDQSxRQUFJQyxNQUFNLFdBQVYsRUFBdUI7QUFDckJKLFdBQUtHLEVBQUVLLFdBQUYsRUFBTCxJQUF3QkosTUFBTSxNQUFOLEdBQWVBLENBQWYsR0FBbUIsSUFBM0M7QUFDRDtBQUNGOztBQUVELFNBQU9KLElBQVA7QUFDRDs7QUFFTSxTQUFTZixhQUFULENBQXVCd0IsS0FBdkIsRUFBc0M7QUFDM0MsTUFBTUMsS0FBSyx3SkFBWDtBQUNBLFNBQU9BLEdBQUdDLElBQUgsQ0FBUUYsS0FBUixDQUFQO0FBQ0Q7O0FBRU0sU0FBU3ZCLFdBQVQsQ0FBcUIwQixJQUFyQixFQUE2QztBQUNsRCxNQUFJQyxNQUFNLENBQVY7QUFDQSxNQUFJQyxhQUFKOztBQUVBLE1BQUlGLFNBQVNHLFNBQVQsSUFBc0JILFNBQVMsSUFBbkMsRUFBeUM7QUFDdkMsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsTUFBTUksTUFBTUosS0FBS0ssT0FBTCxDQUFhLFNBQWIsRUFBd0IsRUFBeEIsQ0FBWjs7QUFFQSxNQUFJRCxJQUFJZCxNQUFKLEtBQWUsY0FBY0EsTUFBakMsRUFBeUM7QUFDdkMsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsTUFBSWMsUUFBUSxhQUFaLEVBQTJCO0FBQ3pCLFdBQU8sS0FBUDtBQUNEOztBQUVELE9BQUssSUFBSWYsSUFBSSxDQUFiLEVBQWdCQSxLQUFLLENBQXJCLEVBQXdCQSxHQUF4QixFQUE2QjtBQUMzQlksV0FBT0ssU0FBU0YsSUFBSUcsU0FBSixDQUFjbEIsSUFBSSxDQUFsQixFQUFxQkEsQ0FBckIsQ0FBVCxFQUFrQyxFQUFsQyxLQUF5QyxLQUFLQSxDQUE5QyxDQUFQO0FBQ0Q7O0FBRURhLFNBQVFELE1BQU0sRUFBUCxHQUFhLEVBQXBCOztBQUVBLE1BQUtDLFNBQVMsRUFBVixJQUFrQkEsU0FBUyxFQUEvQixFQUFvQztBQUNsQ0EsV0FBTyxDQUFQO0FBQ0Q7O0FBRUQsTUFBSUEsU0FBU0ksU0FBU0YsSUFBSUcsU0FBSixDQUFjLENBQWQsRUFBaUIsRUFBakIsQ0FBVCxFQUErQixFQUEvQixDQUFiLEVBQWlEO0FBQy9DLFdBQU8sS0FBUDtBQUNEOztBQUVEO0FBQ0FOLFFBQU0sQ0FBTjtBQUNBLE9BQUssSUFBSVosS0FBSSxDQUFiLEVBQWdCQSxNQUFLLEVBQXJCLEVBQXlCQSxJQUF6QixFQUE4QjtBQUM1QlksV0FBT0ssU0FBU0YsSUFBSUcsU0FBSixDQUFjbEIsS0FBSSxDQUFsQixFQUFxQkEsRUFBckIsQ0FBVCxFQUFrQyxFQUFsQyxLQUF5QyxLQUFLQSxFQUE5QyxDQUFQO0FBQ0Q7O0FBRURhLFNBQVFELE1BQU0sRUFBUCxHQUFhLEVBQXBCOztBQUVBLE1BQUtDLFNBQVMsRUFBVixJQUFrQkEsU0FBUyxFQUEvQixFQUFvQztBQUNsQ0EsV0FBTyxDQUFQO0FBQ0Q7O0FBRUQsU0FBT0EsU0FBU0ksU0FBU0YsSUFBSUcsU0FBSixDQUFjLEVBQWQsRUFBa0IsRUFBbEIsQ0FBVCxFQUFnQyxFQUFoQyxDQUFoQjtBQUNEOztBQUVNLFNBQVNoQyxZQUFULENBQXNCaUMsS0FBdEIsRUFBK0M7QUFDcEQsTUFBSUEsVUFBVUwsU0FBVixJQUF1QkssVUFBVSxJQUFqQyxJQUF5Q0EsTUFBTWxCLE1BQU4sS0FBaUIsRUFBOUQsRUFBa0U7QUFDaEUsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsTUFBTW1CLE9BQU9ELE1BQU1ILE9BQU4sQ0FBYyxTQUFkLEVBQXlCLEVBQXpCLENBQWI7O0FBRUEsTUFDRUksS0FBS25CLE1BQUwsS0FBZ0IsQ0FBaEIsSUFDQW1CLEtBQUtuQixNQUFMLEtBQWdCLEVBRGhCLElBRUFtQixTQUFTLGdCQUZULElBR0FBLFNBQVMsZ0JBSFQsSUFJQUEsU0FBUyxnQkFKVCxJQUtBQSxTQUFTLGdCQUxULElBTUFBLFNBQVMsZ0JBTlQsSUFPQUEsU0FBUyxnQkFQVCxJQVFBQSxTQUFTLGdCQVJULElBU0FBLFNBQVMsZ0JBVFQsSUFVQUEsU0FBUyxnQkFWVCxJQVdBQSxTQUFTLGdCQVpYLEVBYUU7QUFDQSxXQUFPLEtBQVA7QUFDRDs7QUFFRCxNQUFJQyxPQUFPRCxLQUFLbkIsTUFBTCxHQUFjLENBQXpCO0FBQ0EsTUFBSXFCLFVBQVVGLEtBQUtGLFNBQUwsQ0FBZSxDQUFmLEVBQWtCRyxJQUFsQixDQUFkO0FBQ0EsTUFBTUUsU0FBU0gsS0FBS0YsU0FBTCxDQUFlRyxJQUFmLENBQWY7QUFDQSxNQUFJVCxNQUFNLENBQVY7QUFDQSxNQUFJWSxNQUFNSCxPQUFPLENBQWpCO0FBQ0EsT0FBSyxJQUFJckIsSUFBSXFCLElBQWIsRUFBbUJyQixLQUFLLENBQXhCLEVBQTJCQSxHQUEzQixFQUFnQztBQUM5QlksV0FBT0ssU0FBU0ssUUFBUUcsTUFBUixDQUFlSixPQUFPckIsQ0FBdEIsQ0FBVCxFQUFtQyxFQUFuQyxJQUF5Q3dCLEtBQWhEO0FBQ0EsUUFBSUEsTUFBTSxDQUFWLEVBQWE7QUFDWEEsWUFBTSxDQUFOO0FBQ0Q7QUFDRjs7QUFFRCxNQUFJRSxZQUFZZCxNQUFNLEVBQU4sR0FBVyxDQUFYLEdBQWUsQ0FBZixHQUFtQixLQUFLQSxNQUFNLEVBQTlDO0FBQ0EsTUFBSWMsY0FBY1QsU0FBU00sT0FBT0UsTUFBUCxDQUFjLENBQWQsQ0FBVCxFQUEyQixFQUEzQixDQUFsQixFQUFrRDtBQUNoRCxXQUFPLEtBQVA7QUFDRDs7QUFFREosVUFBUSxDQUFSO0FBQ0FDLFlBQVVGLEtBQUtGLFNBQUwsQ0FBZSxDQUFmLEVBQWtCRyxJQUFsQixDQUFWO0FBQ0FULFFBQU0sQ0FBTjtBQUNBWSxRQUFNSCxPQUFPLENBQWI7O0FBRUEsT0FBSyxJQUFJckIsTUFBSXFCLElBQWIsRUFBbUJyQixPQUFLLENBQXhCLEVBQTJCQSxLQUEzQixFQUFnQztBQUM5QlksV0FBT0ssU0FBU0ssUUFBUUcsTUFBUixDQUFlSixPQUFPckIsR0FBdEIsQ0FBVCxFQUFtQyxFQUFuQyxJQUF5Q3dCLEtBQWhEO0FBQ0EsUUFBSUEsTUFBTSxDQUFWLEVBQWE7QUFDWEEsWUFBTSxDQUFOO0FBQ0Q7QUFDRjtBQUNERSxjQUFZZCxNQUFNLEVBQU4sR0FBVyxDQUFYLEdBQWUsQ0FBZixHQUFtQixLQUFLQSxNQUFNLEVBQTFDO0FBQ0EsU0FBT2MsY0FBY1QsU0FBU00sT0FBT0UsTUFBUCxDQUFjLENBQWQsQ0FBVCxFQUEyQixFQUEzQixDQUFyQjtBQUNEOztBQUVNLFNBQVN0QyxlQUFULENBQXlCd0MsS0FBekIsRUFBcUM7QUFDMUMsU0FBT0EsVUFBVWIsU0FBVixJQUF1QmEsVUFBVSxJQUF4QztBQUNEOztBQUVNLFNBQVN2QyxhQUFULENBQXVCd0MsVUFBdkIsRUFBd0NDLFlBQXhDLEVBQXFFO0FBQzFFLFNBQU9BLGFBQWFELFVBQWIsQ0FBUDtBQUNEOztBQUVNLFNBQVN2QyxrQkFBVCxDQUE0QnNDLEtBQTVCLEVBQTJDRyxNQUEzQyxFQUEyRDtBQUNoRSxTQUFPLHNCQUFPSCxLQUFQLEVBQWNHLE1BQWQsRUFBc0IsSUFBdEIsRUFBNEJDLE9BQTVCLEVBQVA7QUFDRDs7QUFFTSxTQUFTekMsb0JBQVQsQ0FBOEJxQyxLQUE5QixFQUE2Q0ssR0FBN0MsRUFBMERDLEdBQTFELEVBQThFO0FBQ25GLFNBQVFOLE1BQU0xQixNQUFOLEdBQWUrQixHQUFoQixLQUEwQkMsUUFBUW5CLFNBQVIsSUFBcUJhLE1BQU0xQixNQUFOLEdBQWVnQyxHQUFyQyxJQUE2Q0EsUUFBUW5CLFNBQTlFLENBQVA7QUFDRDs7QUFFTSxTQUFTdkIsV0FBVCxDQUFxQjJDLElBQXJCLEVBQW1DO0FBQ3hDLE1BQUl0QixNQUFNLENBQVY7QUFDQSxPQUFLLElBQUlaLElBQUksQ0FBYixFQUFnQkEsSUFBSWtDLEtBQUtqQyxNQUF6QixFQUFpQ0QsR0FBakMsRUFBc0M7QUFDcENZLFdBQVFLLFNBQVNpQixLQUFLbEMsQ0FBTCxDQUFULEVBQWtCLEVBQWxCLEtBQXlCa0MsS0FBS2pDLE1BQUwsR0FBY0QsQ0FBZCxHQUFrQixDQUEzQyxDQUFSO0FBQ0Q7QUFDRCxTQUFPWSxNQUFNLEVBQWI7QUFDRDs7QUFFTSxTQUFTcEIsZ0JBQVQsQ0FBMEIwQyxJQUExQixFQUF3QztBQUM3QyxNQUFNQyxJQUFJNUMsWUFBWTJDLElBQVosQ0FBVjtBQUNBLFNBQU9DLElBQUksQ0FBSixHQUFRLEtBQUtBLENBQWIsR0FBaUIsQ0FBeEI7QUFDRDs7QUFFTSxTQUFTMUMsYUFBVCxDQUF1QjJDLFlBQXZCLEVBQW9EO0FBQ3pELFNBQU81QyxpQkFBaUI0QyxhQUFhQyxPQUFiLENBQXFCLENBQXJCLEVBQXdCLEdBQXhCLENBQWpCLENBQVA7QUFDRDs7QUFFTSxTQUFTM0MsV0FBVCxDQUFxQjRDLGFBQXJCLEVBQW1EO0FBQ3hELFNBQU8vQyxZQUFZK0MsY0FBY0MsUUFBZCxFQUFaLENBQVA7QUFDRDs7QUFFTSxTQUFTNUMsV0FBVCxDQUFxQnVDLElBQXJCLEVBQW1DO0FBQ3hDLE1BQUl0QixNQUFNLENBQVY7QUFDQSxPQUFLLElBQUlaLElBQUksQ0FBYixFQUFnQkEsSUFBSWtDLEtBQUtqQyxNQUF6QixFQUFpQ0QsR0FBakMsRUFBc0M7QUFDcEMsUUFBSXdDLFVBQVd2QixTQUFTaUIsS0FBS2xDLENBQUwsQ0FBVCxFQUFrQixFQUFsQixLQUF5QkEsSUFBSSxDQUFKLEdBQVEsQ0FBakMsQ0FBZjtBQUNBLFFBQUl3QyxVQUFVLENBQWQsRUFBaUI7QUFDZkEsZ0JBQVVBLFFBQVFELFFBQVIsR0FBbUJFLEtBQW5CLENBQXlCLEVBQXpCLEVBQTZCQyxHQUE3QixDQUFpQztBQUFBLGVBQUt6QixTQUFTa0IsQ0FBVCxFQUFZLEVBQVosQ0FBTDtBQUFBLE9BQWpDLEVBQXVEUSxNQUF2RCxDQUE4RCxVQUFDQyxDQUFELEVBQUlDLENBQUo7QUFBQSxlQUFVRCxJQUFJQyxDQUFkO0FBQUEsT0FBOUQsQ0FBVjtBQUNEO0FBQ0RqQyxXQUFPNEIsT0FBUDtBQUNEO0FBQ0Q1QixTQUFPLEVBQVA7QUFDQUEsUUFBTUEsUUFBUSxDQUFSLEdBQVksS0FBS0EsR0FBakIsR0FBdUJBLEdBQTdCOztBQUVBLFNBQU9BLEdBQVA7QUFDRCIsImZpbGUiOiJ2YWxpZGF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IEx1Y2FzIFRlc2tlIG9uIDIwLzA0LzE3LlxuICogQGZsb3dcbiAqL1xuXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVYTUxKU09iamVjdFByb3BlcnRpZXMob2JqOiBPYmplY3QpIDogT2JqZWN0IHtcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7XG4gIGNvbnN0IG5PYmogPSB7fTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgY29uc3QgayA9IGtleXNbaV07XG4gICAgaWYgKHR5cGVvZiBvYmpba10gPT09ICdvYmplY3QnKSB7XG4gICAgICBub3JtYWxpemVYTUxKU09iamVjdFByb3BlcnRpZXMob2JqW2tdKTtcbiAgICB9XG4gICAgY29uc3QgdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqW2tdWzBdKSk7XG4gICAgaWYgKHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBuT2JqW2sudG9Mb3dlckNhc2UoKV0gPSB0ICE9PSAnTlVMTCcgPyB0IDogbnVsbDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbk9iajtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlRW1haWwoZW1haWw6IHN0cmluZykge1xuICBjb25zdCByZSA9IC9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvO1xuICByZXR1cm4gcmUudGVzdChlbWFpbCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUNQRihjcGZPOiBzdHJpbmcpIDogYm9vbGVhbiB7XG4gIGxldCBzdW0gPSAwO1xuICBsZXQgaGFzaDtcblxuICBpZiAoY3BmTyA9PT0gdW5kZWZpbmVkIHx8IGNwZk8gPT09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBjcGYgPSBjcGZPLnJlcGxhY2UoL1teXFxkXSsvZywgJycpO1xuXG4gIGlmIChjcGYubGVuZ3RoICE9PSAnMDAwMDAwMDAwMDAnLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChjcGYgPT09ICcwMDAwMDAwMDAwMCcpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmb3IgKGxldCBpID0gMTsgaSA8PSA5OyBpKyspIHtcbiAgICBzdW0gKz0gcGFyc2VJbnQoY3BmLnN1YnN0cmluZyhpIC0gMSwgaSksIDEwKSAqICgxMSAtIGkpO1xuICB9XG5cbiAgaGFzaCA9IChzdW0gKiAxMCkgJSAxMTtcblxuICBpZiAoKGhhc2ggPT09IDEwKSB8fCAoaGFzaCA9PT0gMTEpKSB7XG4gICAgaGFzaCA9IDA7XG4gIH1cblxuICBpZiAoaGFzaCAhPT0gcGFyc2VJbnQoY3BmLnN1YnN0cmluZyg5LCAxMCksIDEwKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIFZlcmlmaWNhdGlvbiBkaWdpdFxuICBzdW0gPSAwO1xuICBmb3IgKGxldCBpID0gMTsgaSA8PSAxMDsgaSsrKSB7XG4gICAgc3VtICs9IHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoaSAtIDEsIGkpLCAxMCkgKiAoMTIgLSBpKTtcbiAgfVxuXG4gIGhhc2ggPSAoc3VtICogMTApICUgMTE7XG5cbiAgaWYgKChoYXNoID09PSAxMCkgfHwgKGhhc2ggPT09IDExKSkge1xuICAgIGhhc2ggPSAwO1xuICB9XG5cbiAgcmV0dXJuIGhhc2ggPT09IHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoMTAsIDExKSwgMTApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVDTlBKKGNucGpPOiBzdHJpbmcpIDogYm9vbGVhbiB7XG4gIGlmIChjbnBqTyA9PT0gdW5kZWZpbmVkIHx8IGNucGpPID09PSBudWxsIHx8IGNucGpPLmxlbmd0aCAhPT0gMTQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBjbnBqID0gY25wak8ucmVwbGFjZSgvW15cXGRdKy9nLCAnJyk7XG5cbiAgaWYgKFxuICAgIGNucGoubGVuZ3RoID09PSAwIHx8XG4gICAgY25wai5sZW5ndGggIT09IDE0IHx8XG4gICAgY25waiA9PT0gJzAwMDAwMDAwMDAwMDAwJyB8fFxuICAgIGNucGogPT09ICcxMTExMTExMTExMTExMScgfHxcbiAgICBjbnBqID09PSAnMjIyMjIyMjIyMjIyMjInIHx8XG4gICAgY25waiA9PT0gJzMzMzMzMzMzMzMzMzMzJyB8fFxuICAgIGNucGogPT09ICc0NDQ0NDQ0NDQ0NDQ0NCcgfHxcbiAgICBjbnBqID09PSAnNTU1NTU1NTU1NTU1NTUnIHx8XG4gICAgY25waiA9PT0gJzY2NjY2NjY2NjY2NjY2JyB8fFxuICAgIGNucGogPT09ICc3Nzc3Nzc3Nzc3Nzc3NycgfHxcbiAgICBjbnBqID09PSAnODg4ODg4ODg4ODg4ODgnIHx8XG4gICAgY25waiA9PT0gJzk5OTk5OTk5OTk5OTk5J1xuICApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBsZXQgc2l6ZSA9IGNucGoubGVuZ3RoIC0gMjtcbiAgbGV0IG51bWJlcnMgPSBjbnBqLnN1YnN0cmluZygwLCBzaXplKTtcbiAgY29uc3QgZGlnaXRzID0gY25wai5zdWJzdHJpbmcoc2l6ZSk7XG4gIGxldCBzdW0gPSAwO1xuICBsZXQgcG9zID0gc2l6ZSAtIDc7XG4gIGZvciAobGV0IGkgPSBzaXplOyBpID49IDE7IGktLSkge1xuICAgIHN1bSArPSBwYXJzZUludChudW1iZXJzLmNoYXJBdChzaXplIC0gaSksIDEwKSAqIHBvcy0tO1xuICAgIGlmIChwb3MgPCAyKSB7XG4gICAgICBwb3MgPSA5O1xuICAgIH1cbiAgfVxuXG4gIGxldCByZXN1bHRhZG8gPSBzdW0gJSAxMSA8IDIgPyAwIDogMTEgLSBzdW0gJSAxMTtcbiAgaWYgKHJlc3VsdGFkbyAhPT0gcGFyc2VJbnQoZGlnaXRzLmNoYXJBdCgwKSwgMTApKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgc2l6ZSArPSAxO1xuICBudW1iZXJzID0gY25wai5zdWJzdHJpbmcoMCwgc2l6ZSk7XG4gIHN1bSA9IDA7XG4gIHBvcyA9IHNpemUgLSA3O1xuXG4gIGZvciAobGV0IGkgPSBzaXplOyBpID49IDE7IGktLSkge1xuICAgIHN1bSArPSBwYXJzZUludChudW1iZXJzLmNoYXJBdChzaXplIC0gaSksIDEwKSAqIHBvcy0tO1xuICAgIGlmIChwb3MgPCAyKSB7XG4gICAgICBwb3MgPSA5O1xuICAgIH1cbiAgfVxuICByZXN1bHRhZG8gPSBzdW0gJSAxMSA8IDIgPyAwIDogMTEgLSBzdW0gJSAxMTtcbiAgcmV0dXJuIHJlc3VsdGFkbyA9PT0gcGFyc2VJbnQoZGlnaXRzLmNoYXJBdCgxKSwgMTApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5kZWZpbmVkT3JOdWxsKGZpZWxkOiBhbnkpIHtcbiAgcmV0dXJuIGZpZWxkID09PSB1bmRlZmluZWQgfHwgZmllbGQgPT09IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUZpZWxkKGZpZWxkVmFsdWU6IGFueSwgdmFsaWRhdGlvbkZuOiBhbnkpIDogYm9vbGVhbiB7XG4gIHJldHVybiB2YWxpZGF0aW9uRm4oZmllbGRWYWx1ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZURhdGVGb3JtYXQoZmllbGQ6IHN0cmluZywgZm9ybWF0OiBzdHJpbmcpIHtcbiAgcmV0dXJuIG1vbWVudChmaWVsZCwgZm9ybWF0LCB0cnVlKS5pc1ZhbGlkKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVN0cmluZ0xlbmd0aChmaWVsZDogc3RyaW5nLCBtYXg6IG51bWJlciwgbWluOiBudW1iZXIgfCB2b2lkKSB7XG4gIHJldHVybiAoZmllbGQubGVuZ3RoIDwgbWF4KSAmJiAoKG1pbiAhPT0gdW5kZWZpbmVkICYmIGZpZWxkLmxlbmd0aCA+IG1pbikgfHwgbWluID09PSB1bmRlZmluZWQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0R2TW9kMTEoZGF0YTogc3RyaW5nKSB7XG4gIGxldCBzdW0gPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICBzdW0gKz0gKHBhcnNlSW50KGRhdGFbaV0sIDEwKSAqIChkYXRhLmxlbmd0aCAtIGkgKyAxKSk7XG4gIH1cbiAgcmV0dXJuIHN1bSAlIDExO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0R2TW9kMTFTdWIxMShkYXRhOiBzdHJpbmcpIHtcbiAgY29uc3QgYyA9IGNhbGNEdk1vZDExKGRhdGEpO1xuICByZXR1cm4gYyA+IDAgPyAxMSAtIGMgOiAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0R2QWdlbmNpYShicmFuY2hOdW1iZXI6IG51bWJlcnxzdHJpbmcpIHtcbiAgcmV0dXJuIGNhbGNEdk1vZDExU3ViMTEoYnJhbmNoTnVtYmVyLnBhZExlZnQoNCwgJzAnKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjRHZDb250YShhY2NvdW50TnVtYmVyOiBudW1iZXJ8c3RyaW5nKSB7XG4gIHJldHVybiBjYWxjRHZNb2QxMShhY2NvdW50TnVtYmVyLnRvU3RyaW5nKCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0R2TW9kMTAoZGF0YTogc3RyaW5nKSB7XG4gIGxldCBzdW0gPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgcGFydGlhbCA9IChwYXJzZUludChkYXRhW2ldLCAxMCkgKiAoaSAlIDIgKyAxKSk7XG4gICAgaWYgKHBhcnRpYWwgPiA5KSB7XG4gICAgICBwYXJ0aWFsID0gcGFydGlhbC50b1N0cmluZygpLnNwbGl0KCcnKS5tYXAoYyA9PiBwYXJzZUludChjLCAxMCkpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpO1xuICAgIH1cbiAgICBzdW0gKz0gcGFydGlhbDtcbiAgfVxuICBzdW0gJT0gMTA7XG4gIHN1bSA9IHN1bSAhPT0gMCA/IDEwIC0gc3VtIDogc3VtO1xuXG4gIHJldHVybiBzdW07XG59XG4iXX0=